let
    Fonte = Excel.Workbook(File.Contents("C:\Users\xxxxxxxx\Documents\My SAS Files\FERIAS E LP\SGPTB18_LICENCA_SAUDE.xlsx"), null, true),
    SGPTB18_LICENCA_SAUDE_Sheet = Fonte{[Item="SGPTB18_LICENCA_SAUDE",Kind="Sheet"]}[Data],
    #"Cabeçalhos Promovidos" = Table.PromoteHeaders(SGPTB18_LICENCA_SAUDE_Sheet, [PromoteAllScalars=true]),
    #"Tipo Alterado" = Table.TransformColumnTypes(#"Cabeçalhos Promovidos",{{"NUMR_SEQC_LICENCA_SAUDE", Int64.Type}, {"SGPTB06_NUMR_MATR_SERV", Int64.Type}, {"NUMR_PROCESSO", type text}, {"NUMR_PORTARIA", Int64.Type}, {"DATA_PUBLICACAO_DOE", type datetime}, {"TIPO_LICENCA_SAUDE", Int64.Type}, {"DATA_INICIO", type datetime}, {"DATA_FIM", type datetime}, {"QTDE_DIAS", Int64.Type}, {"DESC_OBSERVACAO", type text}, {"CODG_SITUACAO_REGISTRO", Int64.Type}, {"DATA_ATUALIZACAO_BD", type datetime}}),
    #"Tipo Alterado1" = Table.TransformColumnTypes(#"Tipo Alterado",{{"DATA_PUBLICACAO_DOE", type date}, {"DATA_INICIO", type date}, {"DATA_FIM", type date}, {"DATA_ATUALIZACAO_BD", type date}}),
    #"Colunas Reordenadas" = Table.ReorderColumns(#"Tipo Alterado1",{"SGPTB06_NUMR_MATR_SERV", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "DATA_PUBLICACAO_DOE", "TIPO_LICENCA_SAUDE", "DATA_INICIO", "DATA_FIM", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Linhas Classificadas" = Table.Sort(#"Colunas Reordenadas",{{"DATA_INICIO", Order.Descending}}),
    #"Colunas Reordenadas1" = Table.ReorderColumns(#"Linhas Classificadas",{"SGPTB06_NUMR_MATR_SERV", "DATA_INICIO", "DATA_FIM", "DATA_PUBLICACAO_DOE", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "TIPO_LICENCA_SAUDE", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Linhas Filtradas" = Table.SelectRows(#"Colunas Reordenadas1", each ([DESC_OBSERVACAO] <> "LANÇAMENTO INCORRETO." and [DESC_OBSERVACAO] <> "REGISTRO INCORRETO" and [DESC_OBSERVACAO] <> "TESTE" and [DESC_OBSERVACAO] <> "TONADO SEM EFEITO CONF BP/PESSOAL/SEFAZ/00789/2024 DE 05/12/24, P. 87.")),
    #"Outras Colunas Removidas" = Table.SelectColumns(#"Linhas Filtradas",{"SGPTB06_NUMR_MATR_SERV", "DATA_INICIO", "DATA_FIM", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "TIPO_LICENCA_SAUDE", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Colunas Mescladas" = Table.CombineColumns(Table.TransformColumnTypes(#"Outras Colunas Removidas", {{"DATA_INICIO", type text}, {"DATA_FIM", type text}}, "pt-BR"),{"DATA_INICIO", "DATA_FIM"},Combiner.CombineTextByDelimiter(" - ", QuoteStyle.None),"Licenca_Saude"),
    #"Coluna Duplicada" = Table.DuplicateColumn(#"Colunas Mescladas", "Licenca_Saude", "Licenca_Saude - Copiar"),
    #"Colunas Reordenadas2" = Table.ReorderColumns(#"Coluna Duplicada",{"SGPTB06_NUMR_MATR_SERV", "Licenca_Saude", "Licenca_Saude - Copiar", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "TIPO_LICENCA_SAUDE", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Colunas Renomeadas" = Table.RenameColumns(#"Colunas Reordenadas2",{{"Licenca_Saude - Copiar", "Licenca_Saude_Ano"}}),
    #"Últimos caracteres extraídos" = Table.TransformColumns(#"Colunas Renomeadas", {{"Licenca_Saude_Ano", each Text.End(_, 4), type text}}),
    #"Coluna Duplicada1" = Table.DuplicateColumn(#"Últimos caracteres extraídos", "Licenca_Saude", "Licenca_Saude - Copiar"),
    #"Colunas Reordenadas3" = Table.ReorderColumns(#"Coluna Duplicada1",{"Licenca_Saude - Copiar", "SGPTB06_NUMR_MATR_SERV", "Licenca_Saude", "Licenca_Saude_Ano", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "TIPO_LICENCA_SAUDE", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Dividir Coluna por Delimitador" = Table.SplitColumn(#"Colunas Reordenadas3", "Licenca_Saude - Copiar", Splitter.SplitTextByDelimiter(" - ", QuoteStyle.Csv), {"Licenca_Saude - Copiar.1", "Licenca_Saude - Copiar.2"}),
    #"Tipo Alterado2" = Table.TransformColumnTypes(#"Dividir Coluna por Delimitador",{{"Licenca_Saude - Copiar.1", type date}, {"Licenca_Saude - Copiar.2", type date}}),
    #"Coluna Duplicada2" = Table.DuplicateColumn(#"Tipo Alterado2", "Licenca_Saude - Copiar.1", "Licenca_Saude - Copiar.1 - Copiar"),
    #"Colunas Reordenadas4" = Table.ReorderColumns(#"Coluna Duplicada2",{"Licenca_Saude - Copiar.1 - Copiar", "Licenca_Saude - Copiar.1", "Licenca_Saude - Copiar.2", "SGPTB06_NUMR_MATR_SERV", "Licenca_Saude", "Licenca_Saude_Ano", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "TIPO_LICENCA_SAUDE", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Colunas Renomeadas1" = Table.RenameColumns(#"Colunas Reordenadas4",{{"Licenca_Saude - Copiar.2", "Licenca_Saude_Fim"}, {"Licenca_Saude - Copiar.1", "Licenca_Saude_Inicio"}, {"Licenca_Saude - Copiar.1 - Copiar", "Licenca_Saude_Mes"}}),
    #"Coluna Duplicada3" = Table.DuplicateColumn(#"Colunas Renomeadas1", "Licenca_Saude_Mes", "Licenca_Saude_Mes - Copiar"),
    #"Colunas Reordenadas5" = Table.ReorderColumns(#"Coluna Duplicada3",{"Licenca_Saude_Mes - Copiar", "Licenca_Saude_Mes", "Licenca_Saude_Inicio", "Licenca_Saude_Fim", "SGPTB06_NUMR_MATR_SERV", "Licenca_Saude", "Licenca_Saude_Ano", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "TIPO_LICENCA_SAUDE", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Colunas Renomeadas2" = Table.RenameColumns(#"Colunas Reordenadas5",{{"Licenca_Saude_Mes - Copiar", "Num_Mes"}}),
    #"Mês Extraído" = Table.TransformColumns(#"Colunas Renomeadas2",{{"Num_Mes", Date.Month, Int64.Type}}),
    #"Nome do Mês Extraído" = Table.TransformColumns(#"Mês Extraído", {{"Licenca_Saude_Mes", each Date.MonthName(_), type text}}),
    #"Colunas Reordenadas6" = Table.ReorderColumns(#"Nome do Mês Extraído",{"SGPTB06_NUMR_MATR_SERV", "Licenca_Saude", "Num_Mes", "Licenca_Saude_Mes", "Licenca_Saude_Inicio", "Licenca_Saude_Fim", "Licenca_Saude_Ano", "NUMR_SEQC_LICENCA_SAUDE", "NUMR_PROCESSO", "NUMR_PORTARIA", "TIPO_LICENCA_SAUDE", "QTDE_DIAS", "DESC_OBSERVACAO", "CODG_SITUACAO_REGISTRO", "DATA_ATUALIZACAO_BD"}),
    #"Linhas Filtradas1" = Table.SelectRows(#"Colunas Reordenadas6", each ([CODG_SITUACAO_REGISTRO] = 1))
in
    #"Linhas Filtradas1"
